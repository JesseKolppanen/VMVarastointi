<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Kalenteri – Varastointisovellus</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background:#f5f5f5; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; }
  header { background:#007bff; color:white; width:100%; padding:10px 0; text-align:center; font-size:1.4em; }
  #controls { margin-top:15px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center; align-items:center; }
  select { padding:6px; border-radius:6px; border:1px solid #ccc; font-size:1em; }
  #monthNav { display:flex; align-items:center; justify-content:center; margin-top:10px; gap:10px; }
  #monthNav button { background:#007bff; border:none; color:white; padding:5px 10px; border-radius:6px; cursor:pointer; font-size:1.2em; }
  #monthName { font-weight:bold; font-size:1.2em; }
  #calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:5px; width:90%; max-width:900px; margin-top:20px; }
  .day { background:white; border-radius:8px; padding:10px; min-height:100px; box-shadow:0 2px 4px rgba(0,0,0,0.1); cursor:pointer; transition: transform 0.2s; display:flex; flex-direction:column; }
  .day:hover { transform:scale(1.03); }
  .today { border:2px solid #007bff; }
  .reservation-preview { background:#007bff; color:white; border-radius:4px; padding:2px 5px; font-size:0.7em; margin-top:3px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  #backBtn { margin:20px; background:#333; color:white; border:none; border-radius:5px; padding:10px 15px; cursor:pointer; }

  /* Modal */
  #dayModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000; }
  #dayModalContent { background:white; padding:20px; border-radius:10px; min-width:300px; max-width:500px; max-height:80%; overflow-y:auto; }
  #dayModalContent ul { list-style:none; padding:0; margin:0; }
  #dayModalContent li { display:flex; justify-content: space-between; align-items:center; padding:5px 0; border-bottom:1px solid #eee; }
  #dayModalContent li button { background:#ff4d4d; color:white; border:none; border-radius:4px; cursor:pointer; padding:2px 6px; }
  #dayModalContent select, #dayModalContent button { margin-top:5px; padding:6px; }
</style>
</head>
<body>
<header>Kalenteri</header>

<button id="backBtn">⬅ Takaisin varastoon</button>

<div id="controls">
  <select id="itemSelect">
    <option value="">Valitse tavara</option>
  </select>
  <select id="personSelect">
    <option value="">Valitse henkilö</option>
  </select>
</div>

<div id="monthNav">
  <button id="prevMonth">←</button>
  <div id="monthName"></div>
  <button id="nextMonth">→</button>
</div>

<div id="calendar"></div>

<!-- Modal -->
<div id="dayModal">
  <div id="dayModalContent">
    <h3 id="modalDate"></h3>
    <ul id="modalReservations"></ul>

    <h4>Lisää varaus</h4>
    <select id="modalItemSelect"><option value="">Valitse tavara</option></select>
    <select id="modalPersonSelect"><option value="">Valitse henkilö</option></select>
    <button id="addReservationBtn">Lisää varaus</button>

    <button id="closeModal">Sulje</button>
  </div>
</div>

<script src="calendar.js"></script>
<script>
  (async () => {
    const res = await fetch("/api/me");
    if (!res.ok) {
      window.location.href = "login.html";
      return;
    }
    const me = await res.json();
    // Piilota muokkausnapit ei-adminilta (UI-tason suojaus)
    if (me.role !== "admin") {
      // Poista/disable napit joita ei-user saa käyttää
      const toDisable = [
        "addPersonBtn","addItemBtn","assignBtn","resetBtn"
      ];
      toDisable.forEach(id => {
        const el = document.getElementById(id);
        if (el) { el.disabled = true; el.style.opacity = 0.6; el.title = "Vain admin"; }
      });
      // Lisäksi: poista dynaamiset Poista/Poista omistajuus -napit renderöinnissä app.js:ssä (jos haluat),
      // mutta tärkeintä on, että BACKEND jo estää POST /api/data -kutsut ei-adminilta.
    }
  })();
</script>
<button id="logoutBtn" style="background:#666;color:#fff;border:none;border-radius:6px;padding:6px 10px; margin-top:10px;">Kirjaudu ulos</button>
<script>
  const lb = document.getElementById("logoutBtn");
  if (lb) lb.addEventListener("click", async () => {
    await fetch("/api/logout", { method: "POST" });
    window.location.href = "login.html";
  });
</script>
</body>
</html>
